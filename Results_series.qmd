---
title: "Results: series"
format: html
server: shiny
---

## Shiny Documents

This Quarto document is made interactive using Shiny. Interactive documents allow readers to modify parameters and see the results immediately. Learn more about Shiny interactive documents at <https://quarto.org/docs/interactive/shiny/>.

Install required packages
```{r}
library(readxl)
library(ggplot2)
library(lme4)
library(lmerTest)
library(DrugClust)
library(dplyr)
library(tidyverse)
library(shiny)
library(vegan)
library(ggpubr)
library(magick)
library(cowplot)
library(strucchange)
library(ggpp)
library(rstatix)
```
Import Basking11 dataset
```{r}
Basking_11 <- read_excel("Basking_11.xlsx")
```
Extract series of consequent measurments. Here we exclude these measurements where Tb<Ts. Bias of 0.2ºC was included due to +/- 0.1ºC precision of the thermal imager
```{r}
Basking_a_ser<-subset(Basking_11, !(is.na(N_ser)))
Basking_a_ser<-subset(Basking_a_ser, Sp=='D.armeniaca')
Basking_a_ser$N_ser[Basking_a_ser$N_ser=='x']<-'ix'
View(Basking_a_ser)
Basking_a_ser$Dif<-Basking_a_ser$T_lizard-Basking_a_ser$T_sub
Basking_a_ser<-subset(Basking_a_ser, Dif>=-0.2)
```
List of series
```{r}
list_of_series<-list()
for(i in Basking_a_ser$N_ser){
  list_of_series<-append(list_of_series, list(assign(paste0('Basking_a_ser_',i), subset(Basking_a_ser, N_ser==i))))
}
# exclude repeated elements
for (k in 1:length(list_of_series)){
  i<- 1
  while(i<=length(list_of_series)){
  j<- 1
    while (j <= length(list_of_series)&i<=length(list_of_series)){
      if(!(j==i)&list_of_series[[j]]$N_ser[1]==list_of_series[[i]]$N_ser[1]){list_of_series<-list_of_series[-j]
        }
      j<-j+1
}
  i<- i+1}
}
#name elements of a list
names<-c()
for(i in list_of_series){
names<-append(names,i$N_ser[1])
}
names(list_of_series)<-names
View(list_of_series)

#exclude small groups
for(i in list_of_series){
  for(j in i$Sp_N){
    k<-subset(i, Sp_N==j)
    #print(nrow(k))
    if(nrow(k)<5){i<-subset(i, !(Sp_N==j))}
  }
}

```
List of Dif~logDt plots
```{r}
plotlist<-list()
for (i in list_of_series){
   assign(paste0('plot_',i$N_ser[1]), (ggplot(i, aes(log(Delta_Time+1, exp(1)), Dif, colour=Sp_N, shape=as.character(N_group), linetype=as.character(N_group))))+ geom_point()+geom_smooth(method='lm', se=FALSE))
   plotlist<-append(plotlist, list(( ggplot(i, aes(log(Delta_Time+1, exp(1)), Dif, colour=Sp_N, shape=as.character(N_group), linetype=as.character(N_group))))+ geom_point()+geom_smooth(method='lm', se=FALSE)))
}
names(plotlist)<-names
```
Exclude series iii: the only solitary lizard is heating 
Exclude series viii and xi: observations of lizards in a group of 2 only 
Exclude animal with less than 5 observations within each Ng class
```{r}
plotlist<-plotlist[names(plotlist) %in% c('viii','xi','iii')==FALSE]
list_of_series<-list_of_series[names(list_of_series) %in% c('viii','xi','iii')==FALSE]

for (i in 1:length(list_of_series)){
j<-1
while (j <=length(list_of_series[[i]]$Sp_N)){
k<-1
while(k <= length(list_of_series[[i]]$N_group)&j <=length(list_of_series[[i]]$Sp_N)){
temp<-subset(list_of_series[[i]], (Sp_N==list_of_series[[i]]$Sp_N[j]&N_group==list_of_series[[i]]$N_group[k]))
if(nrow(temp)<5)list_of_series[[i]]<-subset(list_of_series[[i]], !(Sp_N==list_of_series[[i]]$Sp_N[j]&N_group==list_of_series[[i]]$N_group[k]))
k<-k+1
}
j<-j+1}
}
#New names for the list of series
names<-c()
for(i in list_of_series){
names<-append(names,i$N_ser[1])
}
#New list of plots for the new list of series
plotlist<-list()
for (i in list_of_series){
assign(paste0('plot_',i$N_ser[1]), (ggplot(i, aes(log(Delta_Time+1, exp(1)), Dif, colour=Sp_N, shape=as.character(N_group), linetype=as.character(N_group))))+ geom_point()+geom_smooth(method='lm', se=FALSE))
plotlist<-append(plotlist, list(( ggplot(i, aes(log(Delta_Time+1, exp(1)), Dif, colour=Sp_N, shape=as.character(N_group), linetype=as.character(N_group))))+ geom_point()+geom_smooth(method='lm', se=FALSE)))
}
names(plotlist)<-names 

```
Tb~logDt list of plots
```{r}
plotlist2<-list()
for (i in list_of_series){
       plotlist2<-append(plotlist2, list(( ggplot(i, aes(log(Delta_Time+1, exp(1)), T_lizard, colour=Sp_N, shape=as.character(N_group), linetype=as.character(N_group))))+ geom_point()+geom_smooth(method='lm', se=FALSE)))
   }
 names(plotlist2)<-names
```
Regressions Tb ~ logDT and lists of coefficients
```{r}
#linear models
list_of_ci_intercept<-matrix(ncol=2)
list_of_ci_Time<-matrix(ncol=2)
a<-c(0)
b<-c(0)
signs<-c(0)
for (i in list_of_series){
  for(j in 1:nrow(i)){
    model<-with(subset(i, N_group==i$N_group[j]&Sp_N==i$Sp_N[j]), lm(T_lizard~log(1+Delta_Time, exp(1))))
    assign(paste('lm', i$N_ser[1], i$Sp_N[j],i$N_group[j], sep='_'), model)
    ci<-confint(model)
    signs<-append(signs, paste('lm', i$N_ser[1], i$Sp_N[j],i$N_group[j], sep='_'))
    a<-append(a, coefficients(model)[1])
    b<-append(b, coefficients(model)[2])
    list_of_ci_intercept<-rbind(list_of_ci_intercept, ci[1,])
    list_of_ci_Time<-rbind(list_of_ci_Time, ci[2,])
  }
}
list_of_ci_intercept<-cbind(list_of_ci_intercept, signs)
list_of_ci_Time<-cbind(list_of_ci_Time, signs)
list_of_ci_intercept<-cbind(list_of_ci_intercept, a)
list_of_ci_Time<-cbind(list_of_ci_Time, b)
list_of_ci_intercept<-list_of_ci_intercept[!duplicated(list_of_ci_intercept),]
list_of_ci_Time<-list_of_ci_Time[!duplicated(list_of_ci_Time),]

colnames(list_of_ci_intercept)<-c('lower', 'upper', 'identifier', 'intercept')
colnames(list_of_ci_Time)<-c('lower', 'upper', 'identifier', 'Time')

list_of_ci_intercept<-as.data.frame(list_of_ci_intercept)
list_of_ci_Time<-as.data.frame(list_of_ci_Time)

for (i in 1:nrow(list_of_ci_intercept)){
  splitted<- strsplit(list_of_ci_intercept$identifier[i], split='_')
  list_of_ci_intercept$Series[i]<-splitted[[1]][2]
  list_of_ci_intercept$ID[i]<-splitted[[1]][3]
  list_of_ci_intercept$N_group[i]<-splitted[[1]][4]
}

for (i in 1:nrow(list_of_ci_Time)){
  splitted<- strsplit(list_of_ci_Time$identifier[i], split='_')
  list_of_ci_Time$Series[i]<-splitted[[1]][2]
  list_of_ci_Time$ID[i]<-splitted[[1]][3]
  list_of_ci_Time$N_group[i]<-splitted[[1]][4]
}

list_of_ci_intercept<-list_of_ci_intercept[-1,]
list_of_ci_Time<-list_of_ci_Time[-1,]
list_of_ci_intercept$lower<-as.numeric(list_of_ci_intercept$lower)
list_of_ci_intercept$upper<-as.numeric(list_of_ci_intercept$upper)
list_of_ci_Time$lower<-as.numeric(list_of_ci_Time$lower)
list_of_ci_Time$upper<-as.numeric(list_of_ci_Time$upper)
list_of_ci_intercept$intercept<-as.numeric(list_of_ci_intercept$intercept)
list_of_ci_Time$Time<-as.numeric(list_of_ci_Time$Time)

list_of_ci_intercept_Tb<-list_of_ci_intercept
list_of_ci_Time_Tb<-list_of_ci_Time
```
Regressions Dif~logDt 
```{r}
#linear models
list_of_ci_intercept<-matrix(ncol=2)
list_of_ci_Time<-matrix(ncol=2)
a<-c(0)
b<-c(0)
signs<-c(0)
for (i in list_of_series){
  for(j in 1:nrow(i)){
    model<-with(subset(i, N_group==i$N_group[j]&Sp_N==i$Sp_N[j]), lm(Dif~log(1+Delta_Time, exp(1))))
    assign(paste('lm', i$N_ser[1], i$Sp_N[j],i$N_group[j], sep='_'), model)
    ci<-confint(model)
    signs<-append(signs, paste('lm', i$N_ser[1], i$Sp_N[j],i$N_group[j], sep='_'))
    a<-append(a, coefficients(model)[1])
    b<-append(b, coefficients(model)[2])
    list_of_ci_intercept<-rbind(list_of_ci_intercept, ci[1,])
    list_of_ci_Time<-rbind(list_of_ci_Time, ci[2,])
  }
}
list_of_ci_intercept<-cbind(list_of_ci_intercept, signs)
list_of_ci_Time<-cbind(list_of_ci_Time, signs)
list_of_ci_intercept<-cbind(list_of_ci_intercept, a)
list_of_ci_Time<-cbind(list_of_ci_Time, b)
list_of_ci_intercept<-list_of_ci_intercept[!duplicated(list_of_ci_intercept),]
list_of_ci_Time<-list_of_ci_Time[!duplicated(list_of_ci_Time),]

colnames(list_of_ci_intercept)<-c('lower', 'upper', 'identifier', 'intercept')
colnames(list_of_ci_Time)<-c('lower', 'upper', 'identifier', 'Time')

list_of_ci_intercept<-as.data.frame(list_of_ci_intercept)
list_of_ci_Time<-as.data.frame(list_of_ci_Time)

for (i in 1:nrow(list_of_ci_intercept)){
  splitted<- strsplit(list_of_ci_intercept$identifier[i], split='_')
  list_of_ci_intercept$Series[i]<-splitted[[1]][2]
  list_of_ci_intercept$ID[i]<-splitted[[1]][3]
  list_of_ci_intercept$N_group[i]<-splitted[[1]][4]
}

for (i in 1:nrow(list_of_ci_Time)){
  splitted<- strsplit(list_of_ci_Time$identifier[i], split='_')
  list_of_ci_Time$Series[i]<-splitted[[1]][2]
  list_of_ci_Time$ID[i]<-splitted[[1]][3]
  list_of_ci_Time$N_group[i]<-splitted[[1]][4]
}

list_of_ci_intercept<-list_of_ci_intercept[-1,]
list_of_ci_Time<-list_of_ci_Time[-1,]
list_of_ci_intercept$lower<-as.numeric(list_of_ci_intercept$lower)
list_of_ci_intercept$upper<-as.numeric(list_of_ci_intercept$upper)
list_of_ci_Time$lower<-as.numeric(list_of_ci_Time$lower)
list_of_ci_Time$upper<-as.numeric(list_of_ci_Time$upper)
list_of_ci_intercept$intercept<-as.numeric(list_of_ci_intercept$intercept)
list_of_ci_Time$Time<-as.numeric(list_of_ci_Time$Time)

list_of_ci_intercept_Dif<-list_of_ci_intercept
list_of_ci_Time_Dif<-list_of_ci_Time
```
Plots Tb~logDt and Dif~log
```{r}
for(i in names(list_of_series)){
assign(paste0('ci_adj_plot_', i), ggplot(list_of_ci_Time_Dif[list_of_ci_Time_Dif$Series==i,], aes(ID, Time, colour=ID, fill=ID, group=N_group, shape=N_group))+
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.2, position=position_dodge(width=.9))+
  geom_point(size=2.5, alpha=0.7, position=position_dodge(width=.9))+
  theme_classic()+
  ggtitle(i)
)
}

for(i in names(list_of_series)){
assign(paste0('ci_noadj_plot_', i), ggplot(list_of_ci_Time_Tb[list_of_ci_Time_Tb$Series==i,], aes(ID, Time, colour=ID, fill=ID, group=N_group, shape=N_group))+
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.2, position=position_dodge(width=.9))+
  geom_point(size=2.5, alpha=0.7, position=position_dodge(width=.9))+
  theme_classic()+
  ggtitle(i)
)
}
```
Nested ANOVA and TukeyHSD (and GLMM for effect of Ng on cooling rate) 12.08.2024
```{r}
TukeyHSD(aov(with(list_of_ci_Time_Dif, lm(Time~N_group/Series))))
TukeyHSD(aov(with(list_of_ci_Time_Tb, lm(Time~N_group/Series))))

df<-cbind(list_of_ci_intercept_Tb, list_of_ci_Time_Tb)
model<-lmer(data = df,
            Time~as.character(N_group)+intercept+(1|ID/Series))
summary(model)
emm.model<-emmeans(model, ~as.character(N_group))
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

df<-cbind(list_of_ci_intercept_Dif, list_of_ci_Time_Dif)
model<-lmer(data = df,
            Time~as.character(N_group)+intercept+(1|ID/Series))
summary(model)
emm.model<-emmeans(model, ~as.character(N_group))
contrast(emm.model, interaction = "pairwise", adjust = 'holm')
```
Chow test NOT RUN
```{r}
with(list_of_series[['xv']][list_of_series[['xv']]$Sp_N=='125.0',], sctest(Dif~log(Delta_Time+1, exp(1)), type = "Chow", point = log(30, exp(1))))

with(list_of_series[['xv']][list_of_series[['xv']]$Sp_N=='1555.0',], sctest(Dif~log(Delta_Time+1, exp(1)), type = "Chow", point = log(30, exp(1))))

with(list_of_series[['xv']][list_of_series[['xv']]$Sp_N=='2231.0',], sctest(Dif~log(Delta_Time+1, exp(1)), type = "Chow", point = log(30, exp(1))))

with(list_of_series[['xv']][list_of_series[['xv']]$Sp_N=='455.0',], sctest(Dif~log(Delta_Time+1, exp(1)), type = "Chow", point = log(30, exp(1))))

with(list_of_series[['xv']][list_of_series[['xv']]$Sp_N=='531.0',], sctest(Dif~log(Delta_Time+1, exp(1)), type = "Chow", point = log(30, exp(1))))
```
ANCOVA NOT RUN
```{r}
ancova_i<-with(subset(Basking_a_ser_i, N_group > 1), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_i, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_ii<-with(subset(Basking_a_ser_ii, N_group > 1), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_ii, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_iv<-with(subset(Basking_a_ser_iv, N_group > 1), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_iv, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_v<-with(subset(Basking_a_ser_v, N_group > 1), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_v, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_vi<-with(subset(Basking_a_ser_vi, N_group > 1), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_vi, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_vii<-with(subset(Basking_a_ser_vii, N_group > 1), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_vii, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_ix_2<-with(subset(Basking_a_ser_ix, N_group == 2), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_ix_2, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_ix_3<-with(subset(Basking_a_ser_ix, N_group == 3), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_ix_3, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_xv_3<-with(subset(Basking_a_ser_xv, N_group == 3), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_xv_3, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

ancova_xv_4<-with(subset(Basking_a_ser_xv, N_group == 4), lm(T_lizard~
                                       log(Delta_Time+1, exp(1))+
                                       Sp_N))
emm.model<-emmeans(ancova_xv_4, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#summary(ancova_ii)
#summary(ancova_v)
#summary(ancova_xv)


df<-subset(Basking_a_ser_i, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_i<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

df<-subset(Basking_a_ser_ii, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_ii<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

df<-subset(Basking_a_ser_iv, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_iv<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

df<-subset(Basking_a_ser_v, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_v<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

df<-subset(Basking_a_ser_vi, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_vi<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

df<-subset(Basking_a_ser_vii, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_vii<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

df<-subset(Basking_a_ser_ix, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_ix<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

df<-subset(Basking_a_ser_xv, N_group == 4)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_xv_4<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

df<-subset(Basking_a_ser_xv, N_group == 3)
df$logdt<-log(df$Delta_Time+1, exp(1))
posthoc_xv_3<-emmeans_test(df, T_lizard~Sp_N, logdt, p.adjust.method = 'holm')

#posthoc_ii
#posthoc_v
#posthoc_xv
```
Advanced linear model Tb ~ Sp_N + logdt + Sp_N:logdt
```{r}
df<-subset(Basking_a_ser_i, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_ii, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_iv, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_v, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_vi, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_vii, N_group > 1)
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_ix, N_group == 2)
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_ix, N_group == 3)
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_xv, N_group ==3 )
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

#||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||#
df<-subset(Basking_a_ser_xv, N_group == 4 )
df$logdt<-log(df$Delta_Time+1, exp(1))

model<-lm(data = df,
            T_lizard~Sp_N+logdt+Sp_N:logdt)
emm.model<-emmeans(model, ~Sp_N)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')
```
Advanced mixed linear model Tb~N_group+logdt + 1|ID 12.08.2024
```{r}
df<-rbind(list_of_series[[1]], 
          list_of_series[[2]],
          list_of_series[[3]],
          list_of_series[[4]],
          list_of_series[[5]],
          list_of_series[[6]],
          list_of_series[[7]],
          list_of_series[[8]])
df$N_group<-as.factor(df$N_group)

model<-with(df, lmer(T_lizard~N_group+(1|Sp_N/N_ser)))
summary(model)
emm.model<-emmeans(model, ~N_group)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')

model<-with(df, lmer(Dif~N_group+(1|Sp_N/N_ser)))
summary(model)
emm.model<-emmeans(model, ~N_group)
contrast(emm.model, interaction = "pairwise", adjust = 'holm')
```
Discriptives on Tb difference between animals 02.08.24
```{r}
dif_vec<-c()
for(i in list_of_series[1:6]){
  df<-subset(i, N_group > 1)
  df<- df %>% group_by(Sp_N) %>%
    arrange(Delta_Time) %>%
    slice_head()
  for(j in 1:nrow(df)){
    for(k in 1:nrow(df)){
      if(j != k){
        dif<-abs(df$T_lizard[j]-df$T_lizard[k])
        dif_vec<-append(dif_vec, dif)
      }
    }
  }
}

df<-subset(list_of_series[[7]], N_group == 2)
  df<- df %>% group_by(Sp_N) %>%
    arrange(Delta_Time) %>%
    slice_head()
  for(j in 1:nrow(df)){
    for(k in 1:nrow(df)){
      if(j != k){
        dif<-abs(df$T_lizard[j]-df$T_lizard[k])
        dif_vec<-append(dif_vec, dif)
      }
    }
  }
  
  df<-subset(list_of_series[[7]], N_group == 3)
  df<- df %>% group_by(Sp_N) %>%
    arrange(Delta_Time) %>%
    slice_head()
  for(j in 1:nrow(df)){
    for(k in 1:nrow(df)){
      if(j != k){
        dif<-abs(df$T_lizard[j]-df$T_lizard[k])
        dif_vec<-append(dif_vec, dif)
      }
    }
  }
  
  df<-subset(list_of_series[[8]], N_group == 4)
  df<- df %>% group_by(Sp_N) %>%
    arrange(Delta_Time) %>%
    slice_head()
  for(j in 1:nrow(df)){
    for(k in 1:nrow(df)){
      if(j != k){
        dif<-abs(df$T_lizard[j]-df$T_lizard[k])
        dif_vec<-append(dif_vec, dif)
      }
    }
  }
  
mean(dif_vec)
sd(dif_vec)
median(dif_vec)
max(dif_vec)
min(dif_vec)
```
Fig.4
```{r}
a_b_cor_Dif<-cbind(list_of_ci_intercept_Dif$intercept, list_of_ci_Time_Dif$Time,list_of_ci_intercept_Dif$N_group)
a_b_cor_Tb<-cbind(list_of_ci_intercept_Tb$intercept, list_of_ci_Time_Tb$Time,list_of_ci_intercept_Tb$N_group)

a_b_cor_Dif<-as.data.frame(a_b_cor_Dif)
a_b_cor_Tb<-as.data.frame(a_b_cor_Tb)

a_b_cor_Dif$V1<-as.numeric(a_b_cor_Dif$V1)
a_b_cor_Dif$V2<-as.numeric(a_b_cor_Dif$V2)
a_b_cor_Tb$V1<-as.numeric(a_b_cor_Tb$V1)
a_b_cor_Tb$V2<-as.numeric(a_b_cor_Tb$V2)

Fig4A<-ggplot(a_b_cor_Tb, aes(V1, V2))+geom_smooth(method=lm, colour='grey40', fill='grey80')+geom_point(alpha=0.7,size=3,colour='black', shape=21, aes(fill=V3))+
  theme(panel.border = element_rect(size=1, fill=NA), 
        panel.background = element_rect(fill=NA), 
        legend.position = 'top', 
        axis.title =  element_text(size=16), 
        legend.title = element_text(size=18, hjust = .5), 
        legend.text = element_text(size=14),
        plot.title = element_text(size=14, hjust=.95, vjust=-7)
        )+xlab('Intercept\n\nNon-adjusted')+ylab('Cooling rate')+scale_fill_manual(values=c('grey40', "#00BE67","#F8766D", "#00A9FF"))+guides(fill=guide_legend(title = 'N of individuals in a group', title.position = 'top'))+ggtitle('A')

Fig4B<-ggplot(a_b_cor_Dif, aes(V1, V2))+geom_smooth(method=lm, colour='grey40', fill='grey80')+geom_point(alpha=0.7,size=3,colour='black', shape=21, aes(fill=V3))+
  theme(panel.border = element_rect(size=1, fill=NA), 
        panel.background = element_rect(fill=NA), 
        legend.position = 'top', 
        axis.title =  element_text(size=16), 
        legend.title = element_text(size=18, hjust = .5), 
        legend.text = element_text(size=14),
        plot.title = element_text(size=14, hjust=.95, vjust=-7)
        )+xlab('Intercept\n\nAdjusted')+ylab('Cooling rate')+scale_fill_manual(values=c('grey40',"#F8766D", "#00BE67", "#00A9FF"))+guides(fill=guide_legend(title = 'N of individuals in a group', title.position = 'top'))+ggtitle('B')

Fig4<-ggarrange(Fig4A,Fig4B, common.legend = T)
```
Def function from https://github.com/wilkelab/cowplot/issues/202 NOT RUN
```{r}
get_legend1 <- function(plot, legend = NULL) {
  
  gt <- ggplotGrob(plot)
  
  pattern <- "guide-box"
  if (!is.null(legend)) {
    pattern <- paste0(pattern, "-", legend)
  }
  
  indices <- grep(pattern, gt$layout$name)

  not_empty <- !vapply(
    gt$grobs[indices], 
    inherits, what = "zeroGrob", 
    FUN.VALUE = logical(1)
  )
  indices <- indices[not_empty]
  
  if (length(indices) > 0) {
    return(gt$grobs[[indices[1]]])
  }
  return(NULL)
}

#p <- ggplot(mpg, aes(displ, hwy, colour = factor(cyl), shape = factor(year))) +
#  geom_point() +
#  guides(shape = guide_legend(position = "bottom"))

#plot(get_legend1(p))
#plot(get_legend1(p, "bottom"))
```

Fig5
```{r}
leg.plot<-ggplot(full_join(list_of_series[['ii']], list_of_series[['xv']]),
                 aes(log(Delta_Time+1, exp(1)), Dif, shape=as.character(N_group)))+
  geom_point(size=5, fill='gray70')+
  scale_shape_manual(values = c(21, 22, 23, 24), name='Ng')+
  theme_classic()+
  theme(legend.title.position = 'top', legend.title = element_text(size=14, face = 'bold', hjust = .5), legend.text = element_text(size=12))+
  guides(shape=guide_legend(direction='horizontal'))
  
leg<-get_legend(leg.plot)

Fig5A<-ggplot(list_of_series[['ii']], aes(log(Delta_Time+1, exp(1)), Dif,colour=Sp_N, fill=Sp_N))+
  geom_smooth(alpha=0.4, method='lm')+
  geom_point(aes(shape=as.character(N_group)),colour='black', alpha=0.7, size=2)+
  theme(panel.border = element_rect(size=1, fill=NA), panel.background = element_rect(fill=NA), legend.position = 'none', axis.title.x = element_blank(), plot.title = element_text(size=14, face='bold', hjust=.97, vjust = -7), axis.title = element_text(size=16))+
  #xlab('ln(Dt+1)')+
  ylab('Tb - Ts, ºC')+
  scale_fill_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_colour_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_shape_manual(values = c(21,22))+
  ggtitle('A')

Fig5B<- ggplot(list_of_series[['v']], aes(log(Delta_Time+1, exp(1)), Dif,colour=Sp_N, fill=Sp_N))+
  geom_smooth(alpha=0.3, method='lm')+
  geom_point(aes(shape=as.character(N_group)),colour='black', alpha=0.7, size=2)+
  theme(panel.border = element_rect(size=1, fill=NA), panel.background = element_rect(fill=NA), legend.position = 'none', axis.title.x=element_blank(), plot.title = element_text(size=14, face='bold', hjust=.97, vjust = -7), axis.title = element_text(size=16))+
  #xlab('ln(Dt+1)')+
  ylab('Tb - Ts, ºC')+
  scale_fill_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_colour_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_shape_manual(values = c(21,22))+
  ggtitle('B')

Fig5C<-ggplot(list_of_series[['xv']], aes(log(Delta_Time+1, exp(1)), Dif,colour=Sp_N, fill=Sp_N))+
  geom_smooth(alpha=0.3, method='lm', aes(linetype=as.character(N_group)))+
  geom_point(aes(shape=as.character(N_group)),colour='black', alpha=0.7, size=2)+
  theme(panel.border = element_rect(size=1, fill=NA), panel.background = element_rect(fill=NA), legend.position = 'none', axis.title.x=element_blank(), plot.title = element_text(size=14, face='bold', hjust=.97, vjust = -7), axis.title = element_text(size=16))+
  #xlab('ln(Dt+1)')+
  ylab('Tb - Ts, ºC')+
  scale_fill_manual(values=c("#F8766D",  "#00BE67" , 'grey40', "#DDA9FF", "#00A9FF"))+
  scale_colour_manual(values=c("#F8766D",  "#00BE67", 'grey40' , "#DDA9FF", "#00A9FF"))+
  scale_linetype_manual(values=c('solid','solid','solid'))+xlim(0,4)+
  geom_rect(xmin=2.2, xmax=4, ymin=-0.3, ymax=7, linetype='dashed', fill=NA, colour='black')+
  scale_shape_manual(values = c(21, 22, 23, 24))+
  ggtitle('C')

Fig5D<-ggplot(list_of_series[['xv']], aes(log(Delta_Time+1, exp(1)), Dif,colour=Sp_N, fill=Sp_N))+
  geom_smooth(alpha=0.3, method='lm', aes(linetype=as.character(N_group)))+
  geom_point(aes(shape=as.character(N_group)),colour='black', alpha=0.7, size=2)+
  theme(panel.border = element_rect(size=1, fill=NA), panel.background = element_rect(fill=NA), legend.position = 'none', plot.title = element_text(size=14, face='bold', hjust=.97, vjust = -7), axis.title = element_text(size=16))+
  xlab(expression('ln('~Delta~'t+1)'))+
  ylab('Tb - Ts, ºC')+
  scale_fill_manual(values=c("#F8766D",  "#00BE67" , 'grey40', "#DDA9FF", "#00A9FF"))+
  scale_colour_manual(values=c("#F8766D",  "#00BE67", 'grey40' , "#DDA9FF", "#00A9FF"))+
  scale_linetype_manual(values=c('solid','solid','solid'))+
  xlim(2.2,4.1)+
  ylim(-0.3,7)+
  #geom_segment(x=3.62, y=0.5,xend=3.62,yend=-0.1, colour='black', linewidth=1)+
  #geom_segment(x=3.95, y=1.3,xend=3.95,yend=0.3, colour='black', linewidth=1)+
  #geom_text(x=3.65, y=0.1, label="1", colour='black')+
  #geom_text(x=3.98, y=1.7/2, label="3", colour='black')+
  geom_vline(xintercept = 3.38, linetype='dashed')+
  scale_shape_manual(values = c(21, 22, 23, 24))+
  ggtitle('D')

Fig5E<-ggplot(list_of_ci_Time[list_of_ci_Time_Dif$Series=='xv',], aes(ID, Time, colour=ID, fill=ID, group=N_group, shape=N_group))+
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.2, position=position_dodge(width=.9))+
  geom_point(size=2.5, alpha=0.7,colour='black', position=position_dodge(width=.9))+
  theme(panel.border = element_rect(size=1, fill=NA), panel.background = element_rect(fill=NA),legend.position = 'none', axis.text.x = element_blank(), plot.title = element_text(size=14, face='bold', hjust=.97, vjust = -7), axis.title = element_text(size=16))+
  xlab('')+
  ylab('Adjusted slope\ncoefficient')+
  guides(colour=F,fill=guide_legend(title = 'Ng', title.position = 'top'))+
  scale_fill_manual(values=c("#F8766D",  "#00BE67" , 'grey40', "#DDA9FF", "#00A9FF"))+
  scale_colour_manual(values=c("#F8766D",  "#00BE67", 'grey40' , "#DDA9FF", "#00A9FF"))+
  scale_shape_manual(values = c(21, 22, 23, 24))+
  geom_text(aes(label=round(lower,2),y=list_of_ci_Time_Dif[list_of_ci_Time_Dif$Series=='xv',]$lower-0.4), size=3, position = position_dodge(.9), colour='black')+
  geom_text(aes(label=round(upper,2),y=list_of_ci_Time_Dif[list_of_ci_Time_Dif$Series=='xv',]$upper+0.4), size=3, position = position_dodge(.9), colour='black')+
  geom_label(aes(label=round(Time,2)), position = position_dodgenudge(width = .9, x=-0.25), fill='white', alpha = .7, size=3,label.size = NA, colour='black')+
  ylim(c(-5, 1))+
  ggtitle('G')

Fig5F<-ggplot(list_of_ci_Time[list_of_ci_Time_Dif$Series=='v',], aes( ID, Time, shape=N_group, fill=ID, colour=ID, group=N_group))+
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1)+
  geom_point(size=2.5, alpha=0.7,colour='black')+
  theme(panel.border = element_rect(size=1, fill=NA), panel.background = element_rect(fill=NA),legend.position = 'none', axis.title.x=element_blank(), axis.text.x = element_blank(), plot.title = element_text(size=14, face='bold', hjust=.97, vjust = -7), axis.title = element_text(size=16))+
  ylab('Adjusted slope\ncoefficient')+
  xlab('')+
  guides(colour=F,fill=guide_legend(title = 'N of individuals in a group', title.position = 'top'))+
  scale_fill_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_colour_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_shape_manual(values = c(21, 22))+
  geom_text(aes(label=round(lower,2),y=list_of_ci_Time_Dif[list_of_ci_Time_Dif$Series=='v',]$lower-0.4), size=3, position = position_dodge(.7), colour='black')+
  geom_text(aes(label=round(upper,2),y=list_of_ci_Time_Dif[list_of_ci_Time_Dif$Series=='v',]$upper+0.4), size=3, position = position_dodge(.7), colour='black')+
  geom_label(aes(label=round(Time,2)), position = position_dodgenudge(width = .7, x=-0.18), fill='white', alpha = .7, size=3,label.size = NA, colour='black')+
  ylim(c(-5.8, 0.9))+
  ggtitle('F')

Fig5G<-ggplot(list_of_ci_Time[list_of_ci_Time_Dif$Series=='ii',], aes( ID, Time, shape=N_group, fill=ID, colour=ID, group=N_group))+
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.1)+
  geom_point(size=2.5, alpha=0.7,colour='black')+
  theme(panel.border = element_rect(size=1, fill=NA), panel.background = element_rect(fill=NA),legend.position = 'none', axis.text.x = element_blank(), plot.title = element_text(size=14, face='bold', hjust=.97, vjust = -7), axis.title = element_text(size=16))+
  xlab('')+
  ylab('Adjusted slope\ncoefficient')+
  guides(colour=F,fill=guide_legend(title = 'N of individuals in a group', title.position = 'top'), axis.text.x = element_blank())+
  scale_fill_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_colour_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_shape_manual(values = c(21, 22))+
  geom_text(aes(label=round(lower,2),y=list_of_ci_Time_Dif[list_of_ci_Time_Dif$Series=='ii',]$lower-0.4), size=3, position = position_dodge(.7), colour='black')+
  geom_text(aes(label=round(upper,2),y=list_of_ci_Time_Dif[list_of_ci_Time_Dif$Series=='ii',]$upper+0.4), size=3, position = position_dodge(.7), colour='black')+
  geom_label(aes(label=round(Time,2)), position = position_dodgenudge(width = .7, x=-0.18), fill='white', alpha = .7, size=3,label.size = NA, colour='black')+
  ylim(c(-5.5, 1.5))+
  ggtitle('E')

#leg<-get_legend(ggplot(a_b_cor_Dif, aes(V1, V2))+
#                  geom_point(alpha=0.7,size=3,colour='black', shape=21, aes(fill=V3))+
#                  theme(legend.position = 'top')+
#                  scale_fill_manual(values=c('grey40',"#F8766D", "#00BE67", "#00A9FF"))+
#                  guides(fill=guide_legend(title = 'N of individuals in a group', title.position = 'left')))

liz_blue<-"C:/Users/nikol/OneDrive/Рабочий стол/Статьи в работе/Кооперация и терморегуляция/liz_blue.png"
liz_red<-"C:/Users/nikol/OneDrive/Рабочий стол/Статьи в работе/Кооперация и терморегуляция/liz_red.png"
liz_gray70<-"C:/Users/nikol/OneDrive/Рабочий стол/Статьи в работе/Кооперация и терморегуляция/liz_gray70.png"
liz_green<-"C:/Users/nikol/OneDrive/Рабочий стол/Статьи в работе/Кооперация и терморегуляция/liz_green.png"
liz_orange<-"C:/Users/nikol/OneDrive/Рабочий стол/Статьи в работе/Кооперация и терморегуляция/liz_orange.png"
liz_purple<-"C:/Users/nikol/OneDrive/Рабочий стол/Статьи в работе/Кооперация и терморегуляция/liz_purple.png"

#Fig5<-ggdraw()+
  #draw_plot(Fig5A, x=0,y=3/4, width=1/3, height=0.25)+
  #draw_plot(Fig5B, x=0,y=2/4, width=1/3, height=0.25)+
  #draw_plot(Fig5C, x=0,y=1/4, width=1/3, height=0.25)+
  #draw_plot(Fig5D, x=0,y=0, width=1/3, height=0.25)+
  #draw_plot(Fig5G, x=1/3,y=3/4, width=2/3, height=0.25)+
  #draw_plot(Fig5F, x=1/3,y=2/4, width=2/3, height=0.25)+
  #draw_plot(Fig5E, x=1/3,y=1/4, width=2/3, height=0.25)+
  #draw_plot(leg, x=1/3,y=0, width=2/3, height=0.25)+
  #draw_plot_label(LETTERS[1:7], c(1/3-0.02, 2/3-0.02, 1-0.02, 2/9-0.02, 4/9-0.02,2/3-0.02, 1-0.02), y=c(rep(0.98,3),rep(0.48,4)), size=10)+
  #draw_text('ID', x=1/3+0.01, y=0.095,size=10)+
  #draw_image(liz_blue, scale = .04, x=0.6, y=-0.37)
  #draw_image(liz_gray70, scale = .04, x=-0.376, y=-0.37)+
  #draw_image(liz_red, scale = .04, x=-0.432, y=-0.37)
  
  #draw_image(liz_blue, scale = .04, x=-0.32+0.215, y=-0.37)+
  #draw_image(liz_gray70, scale = .04, x=-0.376+0.215, y=-0.37)+
  #draw_image(liz_red, scale = .04, x=-0.432+0.215, y=-0.37)+
  
 #draw_image(liz_red, scale = .04, x=-0.32+0.215+0.094, y=-0.37)+
 #draw_image(liz_blue, scale = .04, x=-0.32+0.215+0.094+0.037, y=-0.37)+
 #draw_image(liz_gray70, scale = .04, x=-0.32+0.215+0.094+0.074, y=-0.37)+
 #draw_image(liz_green, scale = .04, x=-0.32+0.215+0.094+0.111, y=-0.37)+
 #draw_image(liz_orange, scale = .04, x=-0.32+0.215+0.094+0.148, y=-0.37)

#Alternative####
Fig5<-plot_grid(Fig5A, Fig5G, Fig5B, Fig5F, Fig5C, Fig5E, Fig5D, NULL, nrow=4, align = 'hv', rel_widths =c(1,2,1,2,1,2,1,2))
Fig5+
  draw_plot(leg, x=1/3,y=0, width=2/3, height=0.25)+
  draw_image(liz_red, scale = .04, x=0.42-4*.108, y=-0.23)+
  draw_image(liz_blue , scale = .04, x=0.42, y=-0.23)+
  draw_image(liz_gray70, scale = .04, x=0.42-2*.108, y=-0.23)+
  draw_image(liz_green, scale = .04, x=0.42-3*.108, y=-0.23)+
  draw_image(liz_purple, scale = .04, x=0.42-.108, y=-0.23)+
  
  draw_image(liz_red, scale = .04, x=0.42-2*.108-0.18, y=0.023)+
  draw_image(liz_blue , scale = .04, x=0.42-2*.108+0.18, y=0.023)+
  draw_image(liz_gray70, scale = .04, x=0.42-2*.108, y=0.023)+
  
  draw_image(liz_red, scale = .04, x=0.42-2*.108-0.18, y=0.27)+
  draw_image(liz_blue , scale = .04, x=0.42-2*.108+0.18, y=0.27)+
  draw_image(liz_gray70, scale = .04, x=0.42-2*.108, y=0.27)
```
Fig 6 03.08.24
```{r}
Fig6a<-ggplot(list_of_series[['i']], aes(log(Delta_Time +1), T_lizard))+
  geom_smooth(aes(fill = Sp_N,
                  colour= Sp_N),
              method='lm',
              alpha = .2)+
  geom_point(aes(fill = Sp_N, shape = as.character(N_group)),
             alpha = 0.7,
             size=2.5)+
  theme_classic()+
  theme(#axis.title.x = element_blank(),
    plot.title = element_text(size=16, face='bold', hjust=.97, vjust = -7),
    axis.title = element_text(size=16),
    legend.position = 'none')+
  xlab(expression(''))+
  ylab('Tb, ºC')+
  scale_fill_manual(values=c("#F8766D",'grey40',"#00A9FF", "#00BE67"))+
  scale_colour_manual(values=c("#F8766D",'grey40',"#00A9FF", "#00BE67"))+
  scale_shape_manual(values=c(21, 23))+
  ggtitle('i')

Fig6b<-ggplot(list_of_series[['ii']], aes(log(Delta_Time +1), T_lizard))+
  geom_smooth(aes(fill = Sp_N,
                  colour= Sp_N),
              method='lm',
              alpha = .2)+
  geom_point(aes(fill = Sp_N, shape = as.character(N_group)),
             alpha = 0.7,
             size=2.5)+
  theme_classic()+
  theme(#axis.title.x = element_blank(),
    plot.title = element_text(size=16, face='bold', hjust=.97, vjust = -7),
    axis.title = element_text(size=16),
    legend.position = 'none'
    )+
  xlab(expression(''))+
  ylab('')+
  scale_fill_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_colour_manual(values=c("#F8766D",'grey40',"#00A9FF"))+
  scale_shape_manual(values=c(21, 22))+
  ggtitle('ii')

Fig6c<-ggplot(list_of_series[['iv']], aes(log(Delta_Time +1), T_lizard))+
  geom_smooth(aes(fill = Sp_N,
                  colour= Sp_N),
              method='lm',
              alpha = .2)+
  geom_point(aes(fill = Sp_N, shape = as.character(N_group)),
             alpha = 0.7,
             size=2.5)+
  theme_classic()+
  theme(#axis.title.x = element_blank(),
    plot.title = element_text(size=16, face='bold', hjust=.97, vjust = -7),
    axis.title = element_text(size=16),
    legend.position = 'none'
    )+
  xlab(expression(''))+
  ylab('Tb, ºC')+
  scale_fill_manual(values=c('grey40', "#F8766D","#00A9FF"))+
  scale_colour_manual(values=c('grey40', "#F8766D", "#00A9FF"))+
  scale_shape_manual(values=c(21, 22))+
  ggtitle('iii')

Fig6d<-ggplot(list_of_series[['v']], aes(log(Delta_Time +1), T_lizard))+
  geom_smooth(aes(fill = Sp_N,
                  colour= Sp_N),
              method='lm',
              alpha = .2)+
  geom_point(aes(fill = Sp_N, shape = as.character(N_group)),
             alpha = 0.7,
             size=2.5)+
  theme_classic()+
  theme(#axis.title.x = element_blank(),
    plot.title = element_text(size=16, face='bold', hjust=.97, vjust = -7),
    axis.title = element_text(size=16),
    legend.position = 'none'
    )+
  xlab(expression(''))+
  ylab('')+
  scale_fill_manual(values=c('grey40',"#F8766D", "#00A9FF"))+
  scale_colour_manual(values=c('grey40',"#F8766D","#00A9FF"))+
  scale_shape_manual(values=c(21, 22))+
  ggtitle('iv')

Fig6e<-ggplot(list_of_series[['vi']], aes(log(Delta_Time +1), T_lizard))+
  geom_smooth(aes(fill = Sp_N,
                  colour= Sp_N),
              method='lm',
              alpha = .2)+
  geom_point(aes(fill = Sp_N, shape = as.character(N_group)),
             alpha = 0.7,
             size=2.5)+
  theme_classic()+
  theme(#axis.title.x = element_blank(),
    plot.title = element_text(size=16, face='bold', hjust=.97, vjust = -7),
    axis.title = element_text(size=16),
    legend.position = 'none'
    )+
  xlab(expression(''))+
  ylab('Tb, ºC')+
  scale_fill_manual(values=c('grey40',"#F8766D","#00A9FF"))+
  scale_colour_manual(values=c('grey40',"#F8766D","#00A9FF"))+
  scale_shape_manual(values=c(21, 22))+
  ggtitle('v')

Fig6f<-ggplot(list_of_series[['vii']], aes(log(Delta_Time +1), T_lizard))+
  geom_smooth(aes(fill = Sp_N,
                  colour= Sp_N),
              method='lm',
              alpha = .2)+
  geom_point(aes(fill = Sp_N, shape = as.character(N_group)),
             alpha = 0.7,
             size=2.5)+
  theme_classic()+
  theme(#axis.title.x = element_blank(),
    plot.title = element_text(size=16, face='bold', hjust=.97, vjust = -7),
    axis.title = element_text(size=16),
    legend.position = 'none'
    )+
  xlab(expression(''))+
  ylab('')+
  scale_fill_manual(values=c("#F8766D","#00A9FF", 'grey40',"#00BE67"))+
  scale_colour_manual(values=c("#F8766D","#00A9FF",'grey40',"#00BE67"))+
  scale_shape_manual(values=c(21, 23))+
  ggtitle('vi')

Fig6g<-ggplot(list_of_series[['ix']], aes(log(Delta_Time +1), T_lizard))+
  geom_smooth(aes(fill = Sp_N,
                  colour= Sp_N),
              method='lm',
              alpha = .2)+
  geom_point(aes(fill = Sp_N, shape = as.character(N_group)),
             alpha = 0.7,
             size=2.5)+
  theme_classic()+
  theme(#axis.title.x = element_blank(),
    plot.title = element_text(size=16, face='bold', hjust=.97, vjust = -7),
    axis.title = element_text(size=16),
    legend.position = 'none'
    )+
  xlab(expression('ln('~Delta~'t+1)'))+
  ylab('Tb, ºC')+
  scale_fill_manual(values=c("#F8766D","#00A9FF", '#BB22BB', '#EEEE22',"#00BE67"))+
  scale_colour_manual(values=c("#F8766D","#00A9FF", '#BB22BB', '#EEEE22',"#00BE67"))+
  scale_shape_manual(values=c(22, 23))+
  ggtitle('vii')

Fig6h<-ggplot(list_of_series[['xv']], aes(log(Delta_Time +1), T_lizard))+
  geom_smooth(aes(fill = Sp_N,
                  colour= Sp_N),
              method='lm',
              alpha = .2)+
  geom_point(aes(fill = Sp_N, shape = as.character(N_group)),
             alpha = 0.7,
             size=2.5)+
  theme_classic()+
  theme(#axis.title.x = element_blank(),
    plot.title = element_text(size=16, face='bold', hjust=.97, vjust = -7),
    axis.title = element_text(size=16),
    legend.position = 'none'
    )+
  xlab(expression('ln('~Delta~'t+1)'))+
  ylab('')+
  scale_fill_manual(values=c("#F8766D","#00A9FF", 'gray40', '#EEEE22',"#00BE67"))+
  scale_colour_manual(values=c("#F8766D","#00A9FF", 'gray40', '#EEEE22',"#00BE67"))+
  scale_shape_manual(values=c(21, 23, 24))+
  ggtitle('viii')

leg.plot<-ggplot(full_join(list_of_series[['ii']], list_of_series[['xv']]),
                 aes(log(Delta_Time+1, exp(1)), Dif, shape=as.character(N_group)))+
  geom_point(size=5, fill='gray70')+
  scale_shape_manual(values = c(21, 22, 23, 24), name='Ng')+
  theme_classic()+
  theme(legend.title.position = 'top', legend.title = element_text(size=14, face = 'bold', hjust = .5), legend.text = element_text(size=12))+
  guides(shape=guide_legend(direction='horizontal'))
  
leg<-get_legend(leg.plot)

Fig6<-plot_grid(Fig6a, Fig6b, Fig6c, Fig6d, Fig6e, Fig6f, Fig6g, Fig6h, NULL, nrow=5, ncol=2, align = 'hv', rel_widths = c(rep(1, 8), 2))
Fig6+
  draw_plot(leg, x=1/4, y=0, width=1/2, height=0.4)
```
Nested ANOVA 12.08.2024
```{r}

```